<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>J&K Career Navigator - Dynamic Content Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loading { animation: pulse 2s infinite; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-700 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold">ðŸš€ J&K Career Navigator - Dynamic Content Demo</h1>
            <p class="text-blue-100 mt-2">Full-stack integration: React + Node.js + PostgreSQL + Gemini API</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- API Status -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ðŸ”§ System Status</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div id="api-status" class="p-4 rounded-lg bg-gray-100">
                        <h3 class="font-semibold text-gray-700">Backend API</h3>
                        <p id="api-status-text" class="text-sm text-gray-600 loading">Checking...</p>
                    </div>
                    <div id="db-status" class="p-4 rounded-lg bg-gray-100">
                        <h3 class="font-semibold text-gray-700">Database</h3>
                        <p id="db-status-text" class="text-sm text-gray-600 loading">Checking...</p>
                    </div>
                    <div id="gemini-status" class="p-4 rounded-lg bg-gray-100">
                        <h3 class="font-semibold text-gray-700">Gemini API</h3>
                        <p id="gemini-status-text" class="text-sm text-gray-600 loading">Checking...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dynamic Content Blocks -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ðŸ“„ Dynamic Content Blocks</h2>
                <div id="content-blocks" class="space-y-4">
                    <div class="p-4 bg-gray-100 rounded-lg loading">
                        <p class="text-gray-600">Loading content blocks...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Careers Section -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ðŸ’¼ Featured Careers</h2>
                <div id="careers-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-100 rounded-lg loading">
                        <p class="text-gray-600">Loading careers...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Colleges Section -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ðŸŽ“ Top Colleges</h2>
                <div id="colleges-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="p-4 bg-gray-100 rounded-lg loading">
                        <p class="text-gray-600">Loading colleges...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ðŸ’¬ User Testimonials</h2>
                <div id="testimonials-container" class="space-y-4">
                    <div class="p-4 bg-gray-100 rounded-lg loading">
                        <p class="text-gray-600">Loading testimonials...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Stats -->
        <section class="mb-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">ðŸ“Š Platform Statistics</h2>
                <div id="stats-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="p-4 bg-gray-100 rounded-lg loading">
                        <p class="text-gray-600">Loading stats...</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        const API_BASE = 'http://localhost:5002';

        // Status check functions
        async function checkSystemStatus() {
            try {
                // Check main API
                const apiResponse = await fetch(`${API_BASE}/health`);
                const apiData = await apiResponse.json();
                updateStatus('api-status', apiData.status === 'healthy', `âœ… Running v${apiData.version}`);
                updateStatus('db-status', apiData.database.status !== 'disconnected', 
                    apiData.database.status === 'connected' ? 'âœ… Connected' : 'âš ï¸ Mock Mode');

                // Check Gemini API
                const geminiResponse = await fetch(`${API_BASE}/api/gemini/health`);
                const geminiData = await geminiResponse.json();
                updateStatus('gemini-status', geminiResponse.ok, 'âœ… Available');
            } catch (error) {
                updateStatus('api-status', false, 'âŒ Offline');
                updateStatus('db-status', false, 'âŒ Offline');
                updateStatus('gemini-status', false, 'âŒ Offline');
            }
        }

        function updateStatus(elementId, isHealthy, text) {
            const element = document.getElementById(elementId);
            const textElement = document.getElementById(elementId + '-text');
            
            element.className = `p-4 rounded-lg ${isHealthy ? 'bg-green-100' : 'bg-red-100'}`;
            textElement.className = `text-sm ${isHealthy ? 'text-green-700' : 'text-red-700'}`;
            textElement.textContent = text;
        }

        // Load dynamic content
        async function loadContentBlocks() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/content-blocks/home`);
                const data = await response.json();
                
                const container = document.getElementById('content-blocks');
                container.innerHTML = '';
                
                data.data.forEach(block => {
                    const blockElement = document.createElement('div');
                    blockElement.className = 'p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500 fade-in';
                    blockElement.innerHTML = `
                        <h3 class="font-semibold text-blue-800">${block.title}</h3>
                        <p class="text-blue-600 text-sm mt-1">Type: ${block.block_type}</p>
                        <p class="text-gray-700 mt-2">${block.content}</p>
                        <small class="text-gray-500">Order: ${block.display_order} | Updated by: ${block.updated_by_username}</small>
                    `;
                    container.appendChild(blockElement);
                });
            } catch (error) {
                document.getElementById('content-blocks').innerHTML = 
                    '<div class="p-4 bg-red-100 rounded-lg"><p class="text-red-700">Failed to load content blocks</p></div>';
            }
        }

        async function loadCareers() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/careers?featured=true&limit=6`);
                const data = await response.json();
                
                const container = document.getElementById('careers-grid');
                container.innerHTML = '';
                
                data.data.careers.forEach(career => {
                    const careerCard = document.createElement('div');
                    careerCard.className = 'card bg-white border rounded-lg p-6 shadow-sm fade-in';
                    careerCard.innerHTML = `
                        <h3 class="font-bold text-lg text-gray-800 mb-2">${career.title}</h3>
                        <p class="text-blue-600 text-sm mb-2">${career.category} â€¢ ${career.subcategory}</p>
                        <p class="text-gray-600 text-sm mb-3">${career.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-green-600 font-semibold">â‚¹${(career.avg_salary / 100000).toFixed(1)}L</span>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
                                Demand: ${career.demand_score}%
                            </span>
                        </div>
                        <div class="mt-3">
                            <p class="text-xs text-gray-500">Skills: ${career.skills_required.slice(0, 3).join(', ')}</p>
                        </div>
                    `;
                    container.appendChild(careerCard);
                });
            } catch (error) {
                document.getElementById('careers-grid').innerHTML = 
                    '<div class="col-span-full p-4 bg-red-100 rounded-lg"><p class="text-red-700">Failed to load careers</p></div>';
            }
        }

        async function loadColleges() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/colleges?limit=6`);
                const data = await response.json();
                
                const container = document.getElementById('colleges-grid');
                container.innerHTML = '';
                
                data.data.colleges.forEach(college => {
                    const collegeCard = document.createElement('div');
                    collegeCard.className = 'card bg-white border rounded-lg p-6 shadow-sm fade-in';
                    collegeCard.innerHTML = `
                        <h3 class="font-bold text-lg text-gray-800 mb-2">${college.name}</h3>
                        <p class="text-blue-600 text-sm mb-2">${college.location} â€¢ ${college.type}</p>
                        <p class="text-gray-600 text-sm mb-3">Established: ${college.established}</p>
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-yellow-600">â˜… ${college.rating}/5</span>
                            <span class="text-green-600 text-sm">${college.fees_range}</span>
                        </div>
                        <div class="text-xs text-gray-500">
                            Courses: ${college.courses.slice(0, 3).join(', ')}
                        </div>
                    `;
                    container.appendChild(collegeCard);
                });
            } catch (error) {
                document.getElementById('colleges-grid').innerHTML = 
                    '<div class="col-span-full p-4 bg-red-100 rounded-lg"><p class="text-red-700">Failed to load colleges</p></div>';
            }
        }

        async function loadTestimonials() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/testimonials`);
                const data = await response.json();
                
                const container = document.getElementById('testimonials-container');
                container.innerHTML = '';
                
                data.data.testimonials.forEach(testimonial => {
                    const testimonialElement = document.createElement('div');
                    testimonialElement.className = 'bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-lg border fade-in';
                    testimonialElement.innerHTML = `
                        <div class="flex items-start space-x-4">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">
                                    ${testimonial.name.charAt(0)}
                                </div>
                            </div>
                            <div class="flex-grow">
                                <p class="text-gray-700 italic mb-3">"${testimonial.content}"</p>
                                <div class="flex justify-between items-center">
                                    <div>
                                        <p class="font-semibold text-gray-800">${testimonial.name}</p>
                                        <p class="text-sm text-blue-600">${testimonial.role} at ${testimonial.company}</p>
                                    </div>
                                    <div class="text-yellow-500">
                                        ${'â˜…'.repeat(testimonial.rating)}${'â˜†'.repeat(5 - testimonial.rating)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(testimonialElement);
                });
            } catch (error) {
                document.getElementById('testimonials-container').innerHTML = 
                    '<div class="p-4 bg-red-100 rounded-lg"><p class="text-red-700">Failed to load testimonials</p></div>';
            }
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch(`${API_BASE}/api/v1/dashboard/stats`);
                const data = await response.json();
                
                const container = document.getElementById('stats-grid');
                container.innerHTML = '';
                
                const stats = [
                    { label: 'Careers', value: data.data.total_careers, icon: 'ðŸ’¼', color: 'blue' },
                    { label: 'Colleges', value: data.data.total_colleges, icon: 'ðŸŽ“', color: 'green' },
                    { label: 'Users', value: data.data.total_users.toLocaleString(), icon: 'ðŸ‘¥', color: 'purple' },
                    { label: 'Testimonials', value: data.data.total_testimonials, icon: 'ðŸ’¬', color: 'yellow' }
                ];
                
                stats.forEach(stat => {
                    const statElement = document.createElement('div');
                    statElement.className = `p-4 bg-${stat.color}-50 rounded-lg border-l-4 border-${stat.color}-500 fade-in`;
                    statElement.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-${stat.color}-700">${stat.value}</p>
                                <p class="text-${stat.color}-600 text-sm">${stat.label}</p>
                            </div>
                            <div class="text-2xl">${stat.icon}</div>
                        </div>
                    `;
                    container.appendChild(statElement);
                });
            } catch (error) {
                document.getElementById('stats-grid').innerHTML = 
                    '<div class="col-span-full p-4 bg-red-100 rounded-lg"><p class="text-red-700">Failed to load statistics</p></div>';
            }
        }

        // Initialize everything
        async function initializeDemo() {
            console.log('ðŸš€ Initializing J&K Career Navigator Dynamic Demo');
            
            await checkSystemStatus();
            await Promise.all([
                loadContentBlocks(),
                loadCareers(),
                loadColleges(),
                loadTestimonials(),
                loadDashboardStats()
            ]);
            
            console.log('âœ… Demo initialized successfully');
        }

        // Start the demo when page loads
        window.addEventListener('load', initializeDemo);
        
        // Refresh data every 30 seconds
        setInterval(checkSystemStatus, 30000);
    </script>
</body>
</html>
